<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>CYOAG: Usage and Copyright Concerns</title>
    <link rel='stylesheet' type='text/css' href='css/cyoag-styles.css'>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>
  <body id='body'>
    <div class='cyoag-info-page-container'>
      <h1 class='cyoag-header-title'>CYOAG Usage and Copyright</h1>
      <hr />
      <p>If you believe your copyrighted work was posted on CYOAG without your permission, please feel free to get in touch with us
        using the form below, and we will be happy to work with you to verify your claim and have the content removed.<p>
      Your name:<br />
      <input name='name' id='cyoag-uac-name' type='text' placeholder="Your Name"></input><br /><br />
      Your email address: <br />
      <input name='email' id='cyoag-uac-email' type='text' placeholder="Your E-Mail"></input><br /><br />
      Your message:<br />
      <textarea name='message' id='cyoag-uac-message' placeholder='Your Message' width='100em' height='5em'></textarea><br />
      <span class='cyoag-note'>(please include contact details so we can collaborate on infringement claim resolution)</span><br /><br />
      <div class="g-recaptcha" data-sitekey="6Ld4NhAUAAAAAMcO5QOr9a56765p9ZVsk9CDVnBK"></div><br /><br />
      <div id='cyoag-uac-feedback'></div>
      <button id='cyoag-uac-submit'>Submit</button>
    </div>
    <script type='text/javascript'>
      window.addEventListener('load', init, false);

      var feedback;

      function init() {
        document.getElementById('cyoag-uac-submit').addEventListener('click', submitCrc, false);
        feedback = function(msg) {
          document.getElementById('cyoag-uac-feedback').innerHTML = msg ? msg + '<br /><br />' : '';
        }
      }

        // alert(grecaptcha.getResponse());
      function submitCrc(e) {
        var name = document.getElementById('cyoag-uac-name').value;
        var email = document.getElementById('cyoag-uac-email').value;
        var message = document.getElementById('cyoag-uac-message').value;
        var captcha = grecaptcha.getResponse();

        if(!name) {
          feedback('Please enter a contact name!');
          return;
        }
        if(!/[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}/i.test(email)) {
          feedback('Please enter a valid email address!');
          return;
        }
        if(!message) {
          feedback('Please enter a message!');
          return;
        }
        if(!captcha) {
          feedback('Please complete the reCAPTCHA verification above!');
          return;
        }
        feedback('Claim submitted.  Processing . . .');
        xhr({name:name, email:email, message:message, captcha:captcha});
      }

      function xhr(payload) {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
          if( xhr.readyState == 4 && (xhr.status == 200 || xhr.status == 304) ) {
            feedback(xhr.responseText);
          }
        }
        xhr.open('POST', '/crcSubmit');
        xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
        xhr.timeout = 5000;
        xhr.ontimeout = function() {
          xhr.abort();
          feedback('Server response timed out; unable to submit your message at this time.');
        }
        xhr.send(JSON.stringify(payload));
      }
    </script>
  </body>
</html>
